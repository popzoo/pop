<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="lvlanxing" name="author">
<title>æ–—é±¼ç²‰ä¸ç‰Œ</title>
<link rel="shortcut icon" href="https://rawcdn.githack.com/popzoo/pop/9d4121eed5cbb035e55203b8a9e56a73dcf2e6bf/images/favicon.ico"> 
<meta content="ç²‰ä¸ç‰Œ,æ–—é±¼ç²‰ä¸ç‰Œ,ç‰Œå­,ç²‰ä¸ç‰Œå¤§å…¨ï¼Œæ–—é±¼ç²‰ä¸ç‰Œå¤§å…¨" name="Keywords">
<link rel="stylesheet" href="css/pop_page.css">
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1278032070'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1278032070%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
</head>
<body>
<div style=" height:30px; color:#3C3C3C; line-height:30px; margin:0 0 -30px -130px; padding:20px 0 0 50%; font-size:30px; font-family: Arial,Microsoft YaHei,'å®‹ä½“';">
    ğŸ’RUN_DYNAMIC_GIFT_DATAğŸ’
    <span class="collapse" style="float: right;white-space: nowrap; margin-right: 60px; font-size: 20px;color:#4D4D4D;"> 
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/zoo/">æ—¶å…‰è½´</a> â€¢
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/barrage/">äº‘å¼¹å¹•</a> â€¢
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/pop/giftshow.html">ç¤¼ç‰©ç§€</a> â€¢
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/pop/motorcade.html">è½¦é˜Ÿå±•</a> â€¢
        <a class="nav-link" style="text-decoration:none;" href="https://greasyfork.org/zh-CN/scripts/389379">GreaseFork</a>
    </span>
</div>
<div class="content">
  <div id="device" class="gridalicious">
    <div class="galcolumn">
<!--    <div class="item"><img src="images/1.jpg" alt="å“åº”å¼ç€‘å¸ƒæµå¸ƒå±€æ’ä»¶"/><p>JSä»£ç ç½‘</p></div>  -->
    </div>
  </div>
</div>
<div id="rocket-to-top">
  <div style="opacity: 0; display: block;" class="level-2"></div>
  <div class="level-3"></div>
</div>
    <!-- loadingæŒ‰é’®è‡ªå·±é€šè¿‡æ ·å¼è°ƒæ•´ -->
<footer id="loading" style="width:370px;height:30px;line-height:30px;font-size:18px;text-align:center;border-radius:3px;opacity:0.8;background:#BBBBBB;margin:10px auto 30px;color:black;">
    åŠ è½½ä¸­...
</footer>
<!-- <script src="js/jquery-1.8.3.min.js"></script> -->
<script src="https://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="js/jquery.grid-a-licious.min.js"></script>
<script src="js/spider-background.js"></script> <!-- è››ç½‘èƒŒæ™¯å›¾ -->
<script src="js/rocket.js"></script>
<script type="text/javascript">
    var num = 0;
    var giftList = new Array();
    var numList = JSON.parse(localStorage.getItem("DynamicGiftNumğŸ’¡ğŸŒ„ğŸ’¡"));
    // var count = 0;
    getDyanmicGift();
    function getDyanmicGift(){//todo:==================================è¿™ä¸ªjsonéœ€è¦æé€Ÿ
        fetch('https://cdn.statically.io/gh/popzoo/pop/master/json/dynamic_gift.json',{
            method: 'GET',
            mode: 'cors', //è¯·æ±‚æ¨¡å¼ä¸ºè·¨åŸŸ
            cache: 'default', //no-cache
            credentials: 'omit', // åŒæºåˆ™åŠ å…¥å‡­æ®å¤´,omit,include
        }).then(res => {
            return res.text();
        }).then(result => {
            let arrList = JSON.parse(result);
            for(let i=arrList.length-1;i>=0;i--){
                let jsonData = {"id":arrList[i].id,"name":arrList[i].name,"himg":arrList[i].himg,"exp":arrList[i].exp,"hit_interval":arrList[i].hit_interval,"price_name":arrList[i].price_name,"stay_time":arrList[i].stay_time,"intro":arrList[i].intro};
                giftList.push(jsonData);
            }
            console.info("åŠ¨æ€ç¤¼ç‰©æ€»æ•°:"+giftList.length);

            saveJsonContent(JSON.stringify(giftList),'dynamic_gift.json');
            // $("#device").gridalicious('append', makeboxes());
        }).catch(err => {
            console.error('è¯·æ±‚é”™è¯¯', err);
        })        
    }
    // callbackGift();
    function crawlerDynamicGift(code){
        // const res =$.ajax({
        $.ajax({
            async : true,
            url : "https://webconf.douyucdn.cn/resource/common/gift/gift_template/"+ code +".json",//1~800 20000~20339 è¿™é‡Œè¦çˆ¬
            type : "GET",
            dataType : "jsonp", // è¿”å›çš„æ•°æ®ç±»å‹ï¼Œè®¾ç½®ä¸ºJSONPæ–¹å¼
            jsonp : 'callback', //æŒ‡å®šä¸€ä¸ªæŸ¥è¯¢å‚æ•°åç§°æ¥è¦†ç›–é»˜è®¤çš„ jsonp å›è°ƒå‚æ•°å callback
            jsonpCallback: 'DYConfigCallback', //è®¾ç½®å›è°ƒå‡½æ•°å
            success: function(response, status, xhr){
                if(status == "success"){
                    console.info("æœ‰æ•ˆç¤¼ç‰©æ¨¡æ¿å·ï¼š"+ code);
                    let jsonData=response.data;
                    giftList = mergeRemoveBoth(giftList,response.data);
                    // numList.push(num);
                }
            },
            error:function(XMLHttpRequest, textStatus, errorThrown){
                console.error("å¤±è´¥");
            }
        });
    }

    function mergeRemoveBoth(arr1,arr2){ //ä¸è¦ç›´æ¥ä½¿ç”¨var arr = arr1ï¼Œè¿™æ ·arråªæ˜¯arr1çš„ä¸€ä¸ªå¼•ç”¨ï¼Œä¸¤è€…çš„ä¿®æ”¹ä¼šäº’ç›¸å½±å“
        var arr = arr1.concat();//æˆ–è€…ä½¿ç”¨slice()å¤åˆ¶ï¼Œvar arr = arr1.slice(0)
        for(var i=0;i<arr2.length;i++){
            arr.indexOf(arr2[i]) === -1 ? arr.push(arr2[i]) : 0;
        }
        return arr;
    }

    // function callbackGift(){
    //     if(num<=30000){//<=20339 è¿™é‡Œå¯ä»¥çˆ¬
    //         crawlerDynamicGift();
    //         setTimeout(callbackGift,200);
    //         num++;
    //     }else{
    //         console.info("åŠ¨æ€ç¤¼ç‰©çˆ¬å–å®Œæ¯•");
    //         // localStorage.setItem("DynamicGiftNumğŸ’¡ğŸŒ„ğŸ’¡",JSON.stringify(numList));
    //         localStorage.setItem("GiftDatağŸ’¡ğŸŒ„ğŸ’¡",JSON.stringify(giftList));
    //         saveJsonContent(JSON.stringify(giftList),'dynamic_gift.json');
    //     }
    // }

    function callbackGift(){
        if(num<=numList.length){
            crawlerDynamicGift(numList[num]);
            setTimeout(callbackGift,200);
            num++;
        }else{
            console.info("åŠ¨æ€ç¤¼ç‰©çˆ¬å–å®Œæ¯•");
            localStorage.setItem("GiftDatağŸ’¡ğŸŒ„ğŸ’¡",JSON.stringify(giftList));
            saveJsonContent(JSON.stringify(giftList),'dynamic_gift.json');
        }
    }

    function saveJsonContent (content, fileName) {
        let downLink = document.createElement('a')
        downLink.download = fileName;
        let blob = new Blob([content]);//å­—ç¬¦å†…å®¹è½¬æ¢ä¸ºblodåœ°å€
        downLink.href = URL.createObjectURL(blob);
        document.body.appendChild(downLink);// é“¾æ¥æ’å…¥åˆ°é¡µé¢
        downLink.click();
        document.body.removeChild(downLink);// ç§»é™¤ä¸‹è½½é“¾æ¥
    }         

    </script>
</body>
</html>